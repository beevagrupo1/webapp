{% extends "webapp/base.html" %}
{% load staticfiles %}
{% load disqus_tags %}
{% load gravatar %}


{% block custom_css %}
    <link rel="stylesheet" href="{% static 'webapp/css/jquery.rateyo.min.css' %}"/>
    <link href="http://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css">
{% endblock %}
{% block main %}
    <div class="col-md-8 col-md-offset-2">
        <div class="page-header">
            <h1>{{ activity.title }}
                <small>{{ activity.activity_date|date:"l j \d\e F \d\e\l Y \a \l\a\s H:i" }}</small>
            </h1>
        </div>
        <div class="row">
            <div class="col-md-12">
                <!-- Author overlay -->
                <a class="recipe-author-link" href="#">
                    <div class="img-circle recipe-author recipe-author-picture-container">
                        <div class="img-circle recipe-author-picture"
                             style="background-image: url('{% gravatar_url activity.user_own.email %}')">
                            <img class="img-circle recipe-author"
                                 src="{% gravatar_url activity.user_own.email %}">
                        </div>
                    </div>
                    <h5 class="recipe-author recipe-author-name">By {{ activity.user_own.username }}</h5>
                </a>

                <div id="map-canvas" style="height:380px;"></div>

                <script src="https://maps.googleapis.com/maps/api/js"></script>
                <script>
                    function initialize() {
                        var myLatlng = new google.maps.LatLng({{ activity.position.latitude|safe }}, {{ activity.position.longitude|safe }});
                        var mapProp = {
                            zoom: 16,
                            center: myLatlng
                        };
                        var map = new google.maps.Map(document.getElementById('map-canvas'), mapProp);
                        var marker = new google.maps.Marker({
                            position: myLatlng,
                            map: map,
                            title: '{{ activity.place_name }}'
                        });
                        var contentString = '<div id="content">' +
                                '<div id="siteNotice">' +
                                '</div>' +
                                '<h3 id="firstHeading" class="firstHeading">{{ activity.place_name }}</h3>' +
                                '<div id="bodyContent">' +
                                '<p>{{ activity.description|safe }}</p>' +
                                '</div>' +
                                '</div>';
                        var infowindow = new google.maps.InfoWindow({
                            content: contentString
                        });
                        google.maps.event.addListener(marker, 'click', function () {
                            infowindow.open(map, marker);
                        });
                        infowindow.open(map, marker);
                    }
                    google.maps.event.addDomListener(window, 'load', initialize);
                </script>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="input-group input-primary">
                    <span class="input-group-addon" id="basic-addon1">Precio</span>
                    <input type="text" class="form-control" disabled placeholder="Username"
                           aria-describedby="basic-addon1" value="{{ activity.price }}">
                    <span class="input-group-addon" id="basic-addon1">€</span>
                </div>
            </div>
            <!-- /.col-lg-4 -->
            <div class="col-md-6">
                <div class="input-group input-primary">
                    <span class="input-group-addon" id="basic-addon1">Nº max.</span>
                    <input type="text" class="form-control" disabled placeholder="Username"
                           aria-describedby="basic-addon1" value="{{ activity.limit_participants }}">
                    <span class="input-group-addon" id="basic-addon1">P</span>
                </div>
            </div>
            <!-- /.col-lg-4 -->
        </div>
        {% if user.is_authenticated %}
                <div id="rateYo"></div>
        {% endif %}
        <div class="row">
            <div class="col-md-12 text-center">
                {% if activity.participants.all %}
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Participantes inscritos</h3>
                        </div>
                        <div class="panel-body">
                            {% for userP in activity.participants.all %}
                                <a title="{{ userP.username }}" onclick="return false;">
                                    <img src="{% gravatar_url userP.email %}" alt="{{ userP.username }}">
                                </a>
                            {% endfor %}
                        </div>
                    </div>
                {% else %}
                    <h3>No hay participantes inscritos, se el primero en inscribirte</h3>
                    <a class="btn btn-lg btn-primary" href="{% url 'activity_enrrollment' activity.id %}">Inscribete</a>
                {% endif %}
            </div>
        </div>
        {% disqus_show_comments %}
    </div>
{% endblock %}

{% block custom_js %}
    <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="{% static 'webapp/js/jquery.rateyo.js' %}"></script>

    <script>

        $(function () {

            $("#rateYo").rateYo({
                rating: 3.6
            });

        });

    </script>
{% endblock %}